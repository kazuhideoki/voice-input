# 音声入力モジュールリファクタリング進捗

## 概要

Voice-Input モジュールの再設計を行い、以下の目標を達成します：

- **レイヤ分離**: cliドメイン層、infrastructure層に責務を明確に分ける
- **既存UXの維持**: 既存の機能と使用感を一切変えない
- **依存関係の維持**: 新たな外部クレートを追加しない
- **適切な抽象化**: traitを活用して適切な抽象化を行う（特にAudioBackend）
- **コードの整理**: 関心事の分離を徹底し、メンテナンス性を向上させる

## 実装フェーズ

### Phase 1 : ファイル移動 & 雛形
- ディレクトリ構造の作成
- ファイルの移設と命名修正
- モジュールツリーの宣言（src/lib.rs）

### Phase 2 : AudioBackend 抽出
- AudioBackend traitの定義
- 既存ロジックのcpal_backend.rsへの移行
- thread-localの構造体フィールドへの移行

### Phase 3 : ドメイン層 Recorder／Transcriber
- domain/recorder.rsでの純粋ロジック実装
- domain/transcriber.rsへのOpenAI呼び出し＆WAV→Text処理の移動

### Phase 4 : Infrastructure 外部連携
- external/openai.rsへのHTTP呼び出し関数の移設
- sound.rs / clipboard.rsの抽象化

### Phase 5 : CLI 層薄型化
- cli/record.rs, cli/transcribe.rsの実装
- bin/voice_input.rsの簡素化

### Phase 6 : ビルド & 動作確認
- リリースビルドの実行
- 動作確認テスト

## 進捗トラッキング

| フェーズ | 担当者 | 状態 | 備考 | 最終更新日 |
|---------|-------|------|------|-----------|
| Phase 1 : ファイル移動 & 雛形 | - | ✅ 完了 | ディレクトリ構造作成完了。ファイル移設完了。モジュールツリー宣言完了。コンパイルエラーの修正完了。実装は今後のフェーズで対応。 | 2025-04-26 |
| Phase 2 : AudioBackend 抽出 | - | ⏳ 未着手 | - | 2025-04-26 |
| Phase 3 : ドメイン層 Recorder／Transcriber | - | ⏳ 未着手 | - | 2025-04-26 |
| Phase 4 : Infrastructure 外部連携 | - | ⏳ 未着手 | - | 2025-04-26 |
| Phase 5 : CLI 層薄型化 | - | ⏳ 未着手 | - | 2025-04-26 |
| Phase 6 : ビルド & 動作確認 | - | ⏳ 未着手 | - | 2025-04-26 |

## 完了基準

- [ ] `cargo build` が通る（追加依存なし）
- [ ] 既存コマンドオプション・挙動が完全一致
- [ ] `git diff --stat` が PR 粒度ごとに適切
- [ ] README に新構造図 & ビルド方法を追記

## 更新履歴

- 2025-04-26: 進捗ファイル作成
- 2025-04-26: Phase 1のディレクトリ構造作成とファイル移動を実施
- 2025-04-26: Phase 1完了 - コンパイルエラー修正、スタブモジュール作成
