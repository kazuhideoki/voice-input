# Phase 3 手動テストガイド

## 事前準備

1. プロジェクトのビルド

```bash
cargo build --release
```

2. アクセシビリティ権限の確認

- macOSのシステム環境設定 > セキュリティとプライバシー > プライバシー > アクセシビリティ
- voice_inputdがリストに追加され、チェックが入っていることを確認

3. デーモンの起動

```bash
./target/release/voice_inputd
```

4. 別ターミナルでクライアントを準備

```bash
cd /Users/kazuhideoki/voice_input
```

## テストシナリオ

### 1. 基本動作確認

#### 1.1 スタックモード起動とUI表示

```bash
./target/release/voice_input stack-mode on
```

- [x] UIウィンドウが表示される
- [x] "🟢 Stack Mode ON" と表示される
- [x] キーボードショートカットガイドが表示される
- [x] ガイドに以下が含まれる：
  - Cmd+R: 録音開始/停止
  - Cmd+1-9: スタックペースト（最初の9個）
  - Cmd+C: 全スタッククリア
  - ESC: スタックモード終了

#### 1.2 スタック作成（録音）

- [x] Cmd+R を押して録音開始
- [x] 「テスト1」と発話
- [x] Cmd+R を押して録音停止
- [x] スタック1が作成され、UIに表示される
- [x] スタック1に "Cmd+1" と表示される

### 2. ESCキー操作確認

#### 2.1 ESCキーでのモード終了

- [x] スタックモードがONの状態でESCキーを押す
- [ ] UIウィンドウが即座に閉じる
- [ ] ターミナルで `./target/release/voice_input status` を実行
- [ ] "Stack mode: disabled" と表示される

### 3. 視覚的フィードバック確認

#### 3.1 単一スタックのハイライト

```bash
# スタックモードを再度有効化
./target/release/voice_input stack-mode on
```

- [ ] 3つのスタックを作成（Cmd+R → 発話 → Cmd+R を3回）
- [ ] Cmd+2 を押してスタック2をペースト
- [ ] スタック2が緑色でハイライトされる
- [ ] ハイライトが3秒後に自動的に解除される

#### 3.2 ハイライトの移動

- [ ] Cmd+1 を押す
- [ ] スタック1がハイライトされ、スタック2のハイライトが解除される
- [ ] Cmd+3 を押す
- [ ] スタック3がハイライトされ、スタック1のハイライトが解除される

### 4. 10個以上のスタック確認

#### 4.1 大量スタック作成

- [ ] 12個のスタックを作成（録音を12回実行）
- [ ] スタック1-9に "Cmd+1" ～ "Cmd+9" が表示される
- [ ] スタック10-12には番号のみ表示（Cmd+キーなし）
- [ ] ガイドセクションに警告メッセージが表示される：
      "※ スタック10以降はCmd+キーで操作できません（全12個）"

#### 4.2 10個目以降の操作確認

- [ ] Cmd+9 を押す → スタック9がペーストされハイライトされる
- [ ] Cmd+0 を押す → 何も起こらない（スタック10は操作不可）

### 5. パフォーマンス確認

#### 5.1 UI更新の滑らかさ

- [ ] 連続してCmd+1～9を素早く押す
- [ ] UIが滑らかに更新される（カクつきなし）
- [ ] ハイライトが正しく移動する

#### 5.2 CPU使用率確認

```bash
# 別ターミナルで実行
top -pid $(pgrep voice_input_ui)
```

- [ ] アイドル時のCPU使用率が5%以下
- [ ] ハイライト中でもCPU使用率が10%以下

### 6. エラー処理確認

#### 6.1 存在しないスタック

- [ ] スタックを3つだけ作成した状態でCmd+5を押す
- [ ] エラーメッセージが表示される
- [ ] UIは正常に動作を継続する

#### 6.2 Cmd+Cでの全クリア

- [ ] Cmd+C を押す
- [ ] 確認プロンプトで 'y' を入力
- [ ] 全スタックがクリアされ、UIが更新される
- [ ] スタック件数が0になる

### 7. 統合動作確認

#### 7.1 実使用シナリオ

1. [ ] スタックモードON
2. [ ] 5つのスタックを作成（メモや文章を録音）
3. [ ] エディタを開く
4. [ ] Cmd+3でスタック3をペースト → ハイライト確認
5. [ ] Cmd+1でスタック1をペースト → ハイライト移動確認
6. [ ] Cmd+5でスタック5をペースト → ハイライト移動確認
7. [ ] 3秒待ってハイライト解除を確認
8. [ ] ESCキーでスタックモード終了

## トラブルシューティング

### UIが表示されない場合

1. voice_inputdが起動しているか確認
2. `ps aux | grep voice_input` でプロセスを確認
3. ログを確認: `tail -f ~/.voice_input/logs/voice_input.log`

### キーボードショートカットが効かない場合

1. アクセシビリティ権限を再確認
2. 他のアプリがCmd+キーを使用していないか確認
3. voice_inputdを再起動

### ハイライトが表示されない場合

1. UIウィンドウがフォーカスを失っていないか確認
2. スタックが正常に作成されているか確認
3. `./target/release/voice_input list` でスタック一覧を確認

## 性能測定コマンド

```bash
# メモリ使用量
ps aux | grep voice_input | awk '{print $5 " " $11}'

# CPU使用率（5秒間測定）
top -l 5 -pid $(pgrep voice_input_ui) | grep voice_input_ui | awk '{print $3}'

# レスポンスタイム（簡易測定）
time ./target/release/voice_input list
```

## チェックリスト集計

- [ ] 基本動作: すべて正常
- [ ] ESCキー: 正常に動作
- [ ] 視覚的フィードバック: 3秒タイマー正常
- [ ] 10個以上のスタック: 警告表示正常
- [ ] パフォーマンス: 60fps維持、CPU使用率低
- [ ] エラー処理: 適切なメッセージ表示
- [ ] 統合動作: 実使用で問題なし

## 備考

- テスト実施日時: ******\_\_\_******
- テスト実施者: ******\_\_\_******
- 使用OS: macOS ******\_\_\_******
- 問題があった項目: ******\_\_\_******
- 改善提案: ******\_\_\_******
