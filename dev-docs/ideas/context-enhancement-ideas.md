# 音声入力コンテキスト精度向上アイデア

## 背景

現在の実装では、録音開始時の選択範囲をプロンプトに含めることで文字起こしの精度向上を図っています。
より豊かなコンテキストを提供することで、さらなる精度向上が期待できます。

## 現状分析

**現在の実装**
- 録音開始時の選択テキストをWhisper APIのプロンプトとして使用
- 単一のコンテキスト情報のみを利用

## 改善アイデア一覧

| アイデア | 概要 | 実現方法/設計 | メリット | デメリット | 開発工数 | 想定精度向上 |
|---------|------|-------------|---------|-----------|---------|------------|
| **1. セッションベースコンテキスト管理** | 30分間の非アクティブ期間でセッションを区切り、同一セッション内の過去の音声入力履歴を文脈として利用 | - セッションIDで履歴を管理<br>- タイムアウトで自動セッション切り替え<br>- 最新N件の履歴をプロンプトに含める | - 関連性の高い文脈を自動選択<br>- 実装がシンプル<br>- メモリ効率が良い | - 長時間作業での文脈喪失<br>- セッション境界の判定が難しい | 小（1-2日） | **+10-15%**<br>特に連続した作業での効果大 |
| **2. スマートコンテキスト選択** | 時間的近接性、同一アプリ、テキスト類似度などの重み付けで動的に最適なコンテキストを選択 | - 複数要因のスコアリング<br>- 指数関数的時間減衰<br>- コサイン類似度計算<br>- トークン数制限内で最適化 | - 高精度なコンテキスト選択<br>- 無関係な情報の除外<br>- 柔軟な調整が可能 | - 計算コストが高い<br>- パラメータ調整が必要<br>- 実装が複雑 | 中（3-5日） | **+15-25%**<br>コンテキストの質が大幅改善 |
| **3. 専門用語・固有名詞の自動学習** | 頻出する専門用語や固有名詞を自動検出し、辞書に追加して認識精度を向上 | - 形態素解析で候補抽出<br>- 出現頻度カウント<br>- 閾値超えで自動登録<br>- カタカナ語/英数字混在を優先 | - 手動辞書登録が不要<br>- ユーザー固有の語彙に対応<br>- 継続的な精度向上 | - 誤登録の可能性<br>- 辞書肥大化のリスク<br>- 日本語処理が複雑 | 中（3-4日） | **+20-30%**<br>専門用語認識で劇的改善 |
| **4. アプリケーション別テンプレート** | 使用中のアプリケーションに応じて最適化されたプロンプトテンプレートを自動選択 | - アプリ名取得API利用<br>- テンプレート定義ファイル<br>- 文体・語彙ヒント設定<br>- カスタマイズ可能 | - アプリ特有の文脈に対応<br>- 即座に効果を実感<br>- ユーザーカスタマイズ可能 | - アプリ検出の信頼性<br>- テンプレート管理の手間<br>- 未対応アプリの扱い | 小（1-2日） | **+5-15%**<br>特定アプリで高効果 |
| **5. マルチモーダルコンテキスト** | カーソル周辺テキスト、画面OCR、UI要素情報など視覚的情報も含めた文脈提供 | - アクセシビリティAPI利用<br>- 部分スクリーンショット<br>- OCR処理<br>- カーソル位置追跡 | - 圧倒的に豊富な文脈<br>- 画面上の情報を考慮<br>- 革新的なUX | - 実装が非常に複雑<br>- プライバシー懸念<br>- パフォーマンス影響大 | 大（1-2週間） | **+25-40%**<br>画面情報活用で大幅改善 |
| **6. 時間ベース履歴活用** | 直近X分間の全音声入力履歴をコンテキストとして利用 | - 時間窓での履歴管理<br>- 古い履歴の自動削除<br>- シンプルな連結 | - 実装が最も簡単<br>- 即座に導入可能 | - 無関係な情報混入<br>- コンテキスト肥大化<br>- 精度向上効果が限定的 | 極小（数時間） | **+3-8%**<br>基本的な文脈提供のみ |
| **7. 履歴サマリー生成** | 過去の入力履歴をLLMでサマリー化し、コンパクトで関連性の高いコンテキストを生成 | - 定期的なサマリー生成<br>- LLM API呼び出し<br>- キーワード抽出 | - コンテキストサイズ最適化<br>- 高品質な文脈生成 | - 追加APIコスト<br>- レイテンシ増加<br>- 外部依存性 | 中（2-3日） | **+10-20%**<br>文脈の質は高いがコスト増 |

## 実装優先度の推奨

### 費用対効果マトリックス

| アイデア | 開発工数 | 想定精度向上 | ROI評価 |
|---------|---------|------------|---------|
| 専門用語・固有名詞の自動学習 | 中 | +20-30% | ★★★★★ |
| セッションベースコンテキスト管理 | 小 | +10-15% | ★★★★☆ |
| アプリケーション別テンプレート | 小 | +5-15% | ★★★★☆ |
| スマートコンテキスト選択 | 中 | +15-25% | ★★★☆☆ |
| マルチモーダルコンテキスト | 大 | +25-40% | ★★★☆☆ |
| 履歴サマリー生成 | 中 | +10-20% | ★★☆☆☆ |
| 時間ベース履歴活用 | 極小 | +3-8% | ★★☆☆☆ |

### 短期（すぐに効果が見込める）
1. **セッションベースコンテキスト管理** - 工数小、精度+10-15%
2. **アプリケーション別テンプレート** - 工数小、精度+5-15%
3. **時間ベース履歴活用** - 工数極小、精度+3-8%（プロトタイプとして）

### 中期（より高度な精度向上）
4. **専門用語・固有名詞の自動学習** - 工数中、精度+20-30%（最もROIが高い）
5. **スマートコンテキスト選択** - 工数中、精度+15-25%

### 長期（革新的機能）
6. **マルチモーダルコンテキスト** - 工数大、精度+25-40%（技術的チャレンジ）
7. **履歴サマリー生成** - 工数中、精度+10-20%（コスト考慮要）

## 組み合わせ効果

複数のアイデアを組み合わせることで相乗効果が期待できます：

| 組み合わせ | 想定精度向上 | 備考 |
|-----------|------------|------|
| セッション管理 + アプリ別テンプレート | +15-25% | 基本的な改善の組み合わせ |
| スマート選択 + 専門用語学習 | +30-45% | 高度な文脈理解 |
| セッション + スマート選択 + 専門用語 | +40-55% | 包括的なアプローチ |
| すべての機能 | +50-70% | 最大効果（ただし複雑性も最大）|

## 精度評価の前提条件

- **ベースライン**: 現在の実装（選択テキストのみ）を100%とした場合の相対的な改善率
- **評価方法**: 専門用語、固有名詞、文脈依存語句の認識率で測定
- **対象シナリオ**: プログラミング、ビジネス文書、チャットなど多様な用途での平均値